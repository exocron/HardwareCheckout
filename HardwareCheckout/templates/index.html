{% extends "base.html" %}

{% block head %}
<link rel= "stylesheet" type= "text/css" href="{{ url_for('static',filename='styles/term.css') }}">
<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script src="{{ url_for('static',filename='js/term.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js" integrity="sha256-bQmrZe4yPnQrLTY+1gYylfNMBuGfnT/HKsCGX+9Xuqo=" crossorigin="anonymous"></script>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="columns">
            <div id="stream-1" class="column"></div>
            <div id="stream-2" class="column"></div>
            <div id="stream-3" class="column"></div>
        </div>

        <div class="tab">
            {% for term in terminals %}
            <button class="tablinks" onclick="openTab(event, '{{term[0]}}')">{{term[0]}}</button>
            {% endfor %}
        </div>

        {% for term in terminals %}
        <div id="{{term[0]}}" class="tabcontent">
            <iframe  id="{{ term[0] }}-frame" src="{{term[1]}}" style="height:100%;width:100%;"></iframe>
        </div>
        {% endfor %}
    </div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    let player1 = new Twitch.Player("stream-1", {
        width: 400,
        height: 300,
        channel: "carhackingvillage"
    });
    let player2 = new Twitch.Player("stream-2", {
        width: 400,
        height: 300,
        channel: "carhackingvillage2"
    });
    let player3 = new Twitch.Player("stream-3", {
        width: 400,
        height: 300,
        channel: "carhackingvillage3"
    });

    let socket = io("/queue");
    socket.on("json", function(msg) {
        if (msg.message == "device_available") {
            notify("Your device is ready");
        }
    });

    function notify(msg) {
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification(msg);
        } else {
            alert(msg);
        }
    }

</script>
{% endblock %}
